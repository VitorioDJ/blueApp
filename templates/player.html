<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP3 Player</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #player { margin-top: 20px; }
        .controls { margin-top: 10px; }
        #current-song { margin-top: 10px; font-weight: bold; }
        #song-list {
            border: 1px solid #ccc;
            max-height: 150px; /* Set a fixed height for the scrollable area */
            overflow-y: auto; /* Enable vertical scrolling */
            margin-top: 10px;
            padding: 5px;
        }
        .song-item {
            padding: 5px;
            cursor: pointer;
        }
        .song-item.highlight {
            background-color: #d3d3d3; /* Highlight color for the current song */
        }
    </style>
</head>
<body>
    <h1>MP3 Player</h1>
    <label for="playlist-selector">Select a Playlist:</label>
    <select id="playlist-selector">
        {% for playlist in playlists %}
            <option value="{{ playlist.id }}">{{ playlist.name }}</option>
        {% endfor %}
    </select>
    <div id="player">
        <audio id="audio-player" controls>
            <source id="audio-source" src="" type="audio/mp3">
            Your browser does not support the audio element.
        </audio>
    </div>
    <div id="current-song"><span id="current-song-name">None</span></div>
    
    <div id="song-list"></div> <!-- New song list element -->
    
    <div class="controls">
        <button id="prev-button">Previous</button>
        <button id="next-button">Next</button>
    </div>

    <script>
      // Parse the playlists data from Flask
      const playlistData = JSON.parse('{{ playlists|tojson|safe }}');
      const audioPlayer = document.getElementById('audio-player');
      const audioSource = document.getElementById('audio-source');
      const playlistSelector = document.getElementById('playlist-selector');
      const currentSongName = document.getElementById('current-song-name');
      const songList = document.getElementById('song-list');
  
      let currentSongIndex = 0; // Track the current song index
      let currentPlaylist = [];
  
      // Function to load and play the current song
      function loadAndPlaySong() {
          if (currentPlaylist.length > 0) {
              audioSource.src = currentPlaylist[currentSongIndex].src; // Set the source to the current song
              currentSongName.textContent = currentPlaylist[currentSongIndex].name; // Update the current song name
              audioPlayer.load(); // Load the new audio source
              audioPlayer.play().catch(error => {
                  console.error("Playback failed:", error);
              });
              updateSongList(); // Update the song list display
          }
      }
  
      // Function to update the song list display
      function updateSongList() {
          songList.innerHTML = ''; // Clear the current list
          const startIndex = Math.max(0, currentSongIndex - 2); // Start 2 songs before the current song
          const endIndex = Math.min(currentPlaylist.length, startIndex + 5); // Show 5 songs
  
          for (let i = startIndex; i < endIndex; i++) {
              const songItem = document.createElement('div');
              songItem.className = 'song-item' + (i === currentSongIndex ? ' highlight' : '');
              songItem.textContent = currentPlaylist[i].name;
              songItem.onclick = function() {
                  currentSongIndex = i; // Set the current song index to the clicked song
                  loadAndPlaySong(); // Load and play the selected song
              };
              songList.appendChild(songItem);
          }
      }
  
      // Event listener for playlist selection
      playlistSelector.addEventListener('change', function() {
          const selectedPlaylistId = this.value;
          const selectedPlaylist = playlistData.find(playlist => playlist.id === selectedPlaylistId);
          if (selectedPlaylist && selectedPlaylist.songs.length > 0) {
              currentPlaylist = selectedPlaylist.songs; // Update the current playlist
              currentSongIndex = 0; // Reset to the first song
              loadAndPlaySong(); // Load and play the first song
          }
      });
  
      // Previous button functionality
      document.getElementById('prev-button').addEventListener('click', function() {
          if (currentPlaylist.length > 0) {
              currentSongIndex = (currentSongIndex - 1 + currentPlaylist.length) % currentPlaylist.length; // Loop back to the last song
              loadAndPlaySong(); // Load and play the previous song
          }
      });
  
      // Next button functionality
      document.getElementById('next-button').addEventListener('click', function() {
          if (currentPlaylist.length > 0) {
              currentSongIndex = (currentSongIndex + 1) % currentPlaylist.length; // Loop back to the first song
              loadAndPlaySong(); // Load and play the next song
          }
      });
  
      // Event listener for keyboard navigation
      document.addEventListener('keydown', function(event) {
          if (event.key === 'ArrowUp') {
              if (currentPlaylist.length > 0) {
                  currentSongIndex = (currentSongIndex - 1 + currentPlaylist.length) % currentPlaylist.length; // Loop back to the last song
                  loadAndPlaySong(); // Load and play the previous song
              }
          } else if (event.key === 'ArrowDown') {
              if (currentPlaylist.length > 0) {
                  currentSongIndex = (currentSongIndex + 1) % currentPlaylist.length; // Loop back to the first song
                  loadAndPlaySong(); // Load and play the next song
              }
          } else if (event.key === ' ') { // Spacebar functionality
              event.preventDefault(); // Prevent scrolling the page
              if (audioPlayer.paused) {
                  audioPlayer.play(); // Play the audio if it's paused
              } else {
                  audioPlayer.pause(); // Pause the audio if it's playing
              }
          } else if (event.key === 'ArrowLeft') { // Left arrow key for rewind
              audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 10); // Go back 10 seconds
          } else if (event.key === 'ArrowRight') { // Right arrow key for forward
              audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 10); // Go forward 10 seconds
          }
      });
  
      // Event listener for when the song ends
      audioPlayer.addEventListener('ended', function() {
          currentSongIndex = (currentSongIndex + 1) % currentPlaylist.length; // Move to the next song
          loadAndPlaySong(); // Load and play the next song
      });
  
      // Optional: Automatically play the first song of the first playlist on page load
      window.onload = function() {
          if (playlistData.length > 0 && playlistData[0].songs.length > 0) {
              currentPlaylist = playlistData[0].songs; // Set the current playlist
              currentSongIndex = 0; // Start with the first song
              loadAndPlaySong(); // Load and play the first song
          }
      };
  </script>
  

</body>
</html>